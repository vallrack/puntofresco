rules_version = '2';

service firebase.storage {
  // El nombre del bucket debe ser el que Firebase usa por defecto.
  match /b/punto-fresco-f0c35.appspot.com/o {
    
    // Permite la lectura pública de cualquier archivo bajo la carpeta 'products'.
    // Esto es necesario para que las imágenes se puedan mostrar en la aplicación.
    match /products/{userId}/{fileName} {
       allow read: if true;
       
       // Permite la escritura (crear, actualizar, eliminar) solo si se cumplen dos condiciones:
       // 1. El usuario que hace la petición está autenticado (request.auth != null).
       // 2. El `userId` en la ruta del archivo coincide con el ID del usuario autenticado (request.auth.uid).
       // Esto asegura que un usuario solo pueda subir archivos a su propia "carpeta".
       allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
